<ion-header>
    <ion-navbar [attr.primary]="isEmployer ? '' : null" [attr.secondary]="isEmployer ? null : ''">
        <button menuToggle>
            <ion-icon name="menu"></ion-icon>
        </button>
        <ion-title>{{titlePage}}</ion-title>
    </ion-navbar>
</ion-header>

<ion-content padding>
    <ion-item>
        <ion-label id="label-civi" [ngStyle]="titlestyle" floating>Titre de civilité <span class="asterisk">*</span></ion-label>
        <ion-select id="in-select" [(ngModel)]="title" (ionChange)="titleChange()">
            <ion-option value="Mme">Mme</ion-option>
            <ion-option value="Mlle">Mlle</ion-option>
            <ion-option value="M.">M.</ion-option>
        </ion-select>
    </ion-item>


    <ion-item>
        <ion-label floating>Nom <span class="asterisk">*</span></ion-label>
        <ion-input type="text" [(ngModel)]="lastname" (keyup)="watchLastName($event)"></ion-input>
    </ion-item>
    <div [hidden]="isValideLastName"
         class="error-box">* Saisissez un nom valide
    </div>

    <ion-item>
        <ion-label floating>Prénom <span class="asterisk">*</span></ion-label>
        <ion-input type="text" [(ngModel)]="firstname" (keyup)="watchFirstName($event)"></ion-input>
    </ion-item>
    <div [hidden]="isValideFirstName"
         class="error-box">* Saisissez un prénom valide
    </div>

    <div [hidden]="isRecruiter">
        <ion-item [hidden]="!isEmployer">
            <ion-label floating>Raison sociale</ion-label>
            <ion-input type="text" [(ngModel)]="companyname"
                       (change)="IsCompanyExist($event, 'companyname')"></ion-input>
        </ion-item>

        <ion-item [hidden]="!isEmployer">
            <ion-label floating>SIRET: 999 999 999 99999</ion-label>
            <ion-input type="tel" [(ngModel)]="siret" (keyup)="watchSIRET($event)" maxlength="17"
                       (change)="IsCompanyExist($event, 'siret')"></ion-input>
        </ion-item>
        <div [hidden]="isSIRETValid"
             class="error-box">* Saisissez les 14 chiffres du SIRET
        </div>

        <ion-item [hidden]="!isEmployer">
            <ion-label floating>NAF: 9999A</ion-label>
            <ion-input type="text" [(ngModel)]="ape" (keyup)="watchAPE($event)" maxlength="5"></ion-input>
        </ion-item>
        <div [hidden]="isAPEValid"
             class="error-box">* Saisissez les 4 chiffres suivis d'une lettre
        </div>

        <ion-item [hidden]="!isEmployer">
            <ion-label floating>Convention collective</ion-label>
            <ion-select id="in-select" [(ngModel)]="conventionId" (ionChange)="watchConvention()">
                <ion-option *ngFor="let c of conventions" (click)="convSelected(c)" value="{{c.id}}">
                    {{c.code}} - {{c.libelle}}
                </ion-option>
            </ion-select>
        </ion-item>

        <ion-item style="margin-top: 1.5em" [hidden]="isEmployer || isAndroid4">
            <ion-label>Date de naissance</ion-label>
            <ion-datetime [(ngModel)]="birthdate" displayFormat="DD/MM/YYYY" cancelText="Annuler" doneText="Ok"
                          (ionChange)="watchBirthdate($event)"></ion-datetime>
        </ion-item>
        <div [hidden]="isBirthdateValid"
             class="error-box">* Vous devez avoir plus de 18 ans pour pouvoir valider votre profil
        </div>

        <ion-item [hidden]="isEmployer || !isAndroid4">
            <ion-label floating>Date</ion-label>
            <ion-input type="text" [(ngModel)]="birthdate"
                       (focus)="launchDateTimePicker('date')" readonly></ion-input>
        </ion-item>

        <ion-item [hidden]="isEmployer">
            <ion-label floating>Pays de naissance</ion-label>
            <ion-select [(ngModel)]="index" (ionChange)="watchBirthCountry()">
                <ion-option *ngFor="let p of pays" [value] = "p.indicatif_telephonique" value="p.nom">{{p.nom}}</ion-option>
            </ion-select>
        </ion-item>

        <ion-item *ngIf="!isEmployer && !isFrench">
            <ion-label floating>Code postal du lieu de naissance</ion-label>
            <ion-input type="text" [(ngModel)]="indexForForeigner" disabled></ion-input>
        </ion-item>

        <ion-item [hidden]="isEmployer || !isFrench">
            <ion-label floating> Département de naissance </ion-label>
            <ion-input type="text" [(ngModel)]="birthdep" (keyup)="watchBirthDep($event)"></ion-input>
        </ion-item>
        <ion-item [hidden]="isEmployer || departments.length==0">
            <ion-list>
                <ion-item *ngFor="let d of departments" (click)="departmentSelected(d)">
                    {{d.numero}}
                </ion-item>
            </ion-list>
        </ion-item>

        <ion-item [hidden]="isEmployer || !isFrench">
            <ion-label floating>Lieu de naissance</ion-label>
            <ion-input type="text" [(ngModel)]="birthplace" (keyup)="watchBirthPlace($event)"></ion-input>
        </ion-item>
        <ion-item [hidden]="isEmployer || communes.length==0">
            <ion-list>
                <ion-item *ngFor="let c of communes" (click)="communeSelected(c)">
                    {{c.nom}}
                </ion-item>
            </ion-list>
        </ion-item>

        <ion-item [hidden]="!isEmployer">
            <ion-label floating>Organisme de médecine de travail</ion-label>
            <ion-input type="text" [(ngModel)]="medecineTravail" (keyup)="watchMedecineTravail($event)"></ion-input>
        </ion-item>
        <ion-item [hidden]="!isEmployer || medecines.length==0">
            <ion-list>
                <ion-item *ngFor="let c of medecines" (click)="medecineSelected(c)">
                    {{c.libelle}}
                </ion-item>
            </ion-list>
        </ion-item>

        <!--<ion-item [hidden]="isEmployer">
            <ion-label floating>Carte nationale d'identité</ion-label>
            <ion-input type="text" [(ngModel)]="cni" (keyup)="watchCNI($event)" maxlength="12"></ion-input>
        </ion-item>-->

        <ion-item [hidden]="isEmployer">
            <ion-label floating>N° de sécurité sociale</ion-label>
            <ion-input type="number" [(ngModel)]="numSS" (keyup)="watchNumSS($event)" maxlength="15"></ion-input>
        </ion-item>
		<div *ngIf="showNSSError()" class="error-box">{{numSSMessage}}</div>
        <ion-item [hidden]="isEmployer">
            <ion-label [ngStyle]="nationalitiesstyle" floating>Nationalité</ion-label>
            <ion-select [(ngModel)]="nationality" (ionChange)="onChangeNationality($event)">
                <ion-option *ngFor="let n of nationalities" value="{{n.pk_user_nationalite}}">{{n.libelle}}</ion-option>
            </ion-select>
        </ion-item>

        <ion-item [hidden]="isEmployer || isFrench">
            <ion-label [ngStyle]="nationalitiesstyle" floating>Identifiant de nationalité</ion-label>
            <ion-input type="text" [(ngModel)]="idNationaliteLabel" disabled></ion-input>
        </ion-item>

        <ion-list radio-group [(ngModel)]="isResident" style="margin-bottom: 5px;" *ngIf="!isEmployer && isEuropean == 1" >
            <ion-list-header>
                Type de document
            </ion-list-header>
            <ion-item>
                <ion-label>Carte de séjour temporaire</ion-label>
                <ion-radio value="0"></ion-radio>
            </ion-item>
            <ion-item>
                <ion-label>Carte de résident</ion-label>
                <ion-radio value="1"></ion-radio>
            </ion-item>
        </ion-list>

        <ion-list radio-group [(ngModel)]="isCIN" style="margin-bottom: 5px;" *ngIf="!isEmployer && isEuropean == 0" >
            <ion-list-header>
                Type de document
            </ion-list-header>
            <ion-item>
                <ion-label>CNI ou passeport</ion-label>
                <ion-radio value="1"></ion-radio>
            </ion-item>
            <ion-item>
                <ion-label>Carte de ressortissant d'un état membre de l'UE</ion-label>
                <ion-radio value="0"></ion-radio>
            </ion-item>
        </ion-list>

        <ion-item *ngIf="!isEmployer && isEuropean == 1">
            <ion-label floating> {{isResident == 0 ? 'N° du titre de séjour' : 'N° de la carte résident'}}</ion-label>
            <ion-input type="text" [(ngModel)]="numStay"></ion-input>
        </ion-item>

        <ion-item [hidden]="isEmployer || isEuropean == 1 || isCIN == '0'">
            <ion-label floating> N° de la CNI ou Passeport </ion-label>
            <ion-input type="text" [(ngModel)]="cni" (keyup)="watchOfficialDocument($event)" maxlength="13"></ion-input>
        </ion-item>
        <div *ngIf="showCNIError()"
             class="error-box">{{cniHint}}
        </div>

        <ion-item [hidden]="isEmployer || isEuropean == 1 || isCIN == '1'">
            <ion-label floating> N° de la carte de ressortissant </ion-label>
            <ion-input type="text" [(ngModel)]="numStay"></ion-input>
        </ion-item>

            <ion-item [hidden]="isEmployer">
            <ion-label>Pièce d'identité délivrée le</ion-label>
            <ion-datetime [(ngModel)]="tsejProvideDate" (ionChange)="watchTsejProvideDate($event)"
                          displayFormat="DD/MM/YYYY" cancelText="Annuler" doneText="Ok" [(max)]="maxtsejProvideDate"
                          [(min)]="mintsejProvideDate"></ion-datetime>
        </ion-item>
        <ion-item [hidden]="isEmployer">
            <ion-label>Pièce d'identité valable du</ion-label>
            <ion-datetime [(ngModel)]="tsejFromDate" (ionChange)="watchTsejFromDate($event)"
                          displayFormat="DD/MM/YYYY" cancelText="Annuler" doneText="Ok" [(max)]="maxtsejFromDate"
                          [(min)]="mintsejFromDate"></ion-datetime>
        </ion-item>
        <ion-item [hidden]="isEmployer">
            <ion-label>Pièce d'identité valable au</ion-label>
            <ion-datetime [(ngModel)]="tsejToDate" displayFormat="DD/MM/YYYY" cancelText="Annuler" doneText="Ok"
                          [(max)]="maxtsejToDate" [(min)]="mintsejToDate"></ion-datetime>
        </ion-item>
        <ion-item [hidden]="isEmployer">
            <ion-label [ngStyle]="nationalitiesstyle" floating>Délivré par</ion-label>
            <ion-select [(ngModel)]="prefecture">
                <ion-option *ngFor="let n of prefectures" value="{{n.pk_user_prefecture}}">{{n.nom}}</ion-option>
            </ion-select>
        </ion-item>
        <div class="error-box">{{tsMessage}}</div>

        <ion-row>
            <ion-col text-center>
                <ion-label>{{uploadVerb}} une photo {{scanTitle}}</ion-label>
                <button [hidden]="scanUri" class="file-upload button-picture" [style.backgroundColor]="themeColor">
                    <input id="fileinput" type="file" class="file-input" (change)="onChangeUpload($event)">
                    <ion-icon name='folder'></ion-icon>
                </button>

                <button [hidden]="scanUri" seconde (click)="takePicture()" [style.backgroundColor]="themeColor"
                        class="button-picture">
                    <ion-icon name="camera"></ion-icon>
                </button>
            </ion-col>
        </ion-row>


        <ion-card style="margin: auto;" [hidden]="!scanUri" id="card-file">
            <img [src]="scanUri"/>
            <ion-row>
                <ion-col text-center>
                    <button style="margin: auto;" clear (click)="showModal()" small>
                        <ion-icon name='expand'></ion-icon>
                    </button>
                </ion-col>
                <ion-col text-center>
                    <button style="margin: auto;" clear (click)="onDelete()" small>
                        <ion-icon name='close'></ion-icon>
                    </button>
                </ion-col>
            </ion-row>
        </ion-card>


        <!-- <ion-row>
            <ion-col text-center>
                <button class="file-upload button-picture">
                    <input type="file" class="file-input" (change)="onChangeUpload($event)">
                    <ion-icon name="download" style="padding-right: .4em;"></ion-icon>
                     Charger un scan {{scanTitle}}
                </button>
            </ion-col>
        </ion-row>

        <ion-row>
            <ion-col text-center>
                <button block (click)="takePicture()" [style.backgroundColor]="themeColor" class="button-picture">
                    <ion-icon name="md-camera"></ion-icon>
                    Prendre une photo {{scanTitle}}
                </button>
            </ion-col>
        </ion-row>

        <ion-card [hidden]="!scanUri">
            <ion-card-content>
                <img [src]="scanUri"/>
            </ion-card-content>
        </ion-card>
        -->
    </div>
    <ion-row>
        <ion-col width-10></ion-col>
        <ion-col text-center>
            <button block (click)="updateCivility()" [style.backgroundColor]="themeColor"
                    [disabled]="isUpdateDisabled()" type="submit">
                <ion-icon name="done-all"></ion-icon>
                Valider
            </button>
        </ion-col>
        <ion-col width-10></ion-col>
    </ion-row>
</ion-content>

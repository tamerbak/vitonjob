<ion-header>
    <ion-navbar [attr.primary]="isEmployer ? '' : null" [attr.secondary]="isEmployer ? null : ''" style="opacity: 1;">
        <ion-title>Job</ion-title>
        <ion-buttons end>
            <button (click)="closeModal()">
                <ion-icon name="close-circle" style="font-size: xx-large;"></ion-icon>
            </button>
        </ion-buttons>
    </ion-navbar>
</ion-header>

<ion-content padding class="modal-job">
    <!--form [ngFormModel]="jobForm">
        <!-- Sector field-->
    <ion-item>
        <ion-label floating><span style="color: red">* </span>Secteur</ion-label>
        <ion-input [(ngModel)]="jobData.sector" (keyup)="watchSector($event)"></ion-input>
        <button small class="text-size" item-right (click)="setSectorsPicker()">
            <ion-icon name="list"></ion-icon>
        </button>
    </ion-item>
    <ion-item *ngIf="sectors.length>0">
        <ion-list>
            <ion-item *ngFor="let s of sectors" (click)="sectorSelected(s)">
                {{s.libelle}}
            </ion-item>
        </ion-list>
    </ion-item>
    <div [hidden]="isSectorFound"
         style="color:red">
        <ion-icon name="md-arrow-dropup"></ion-icon>
        Veuillez saisir un secteur valide, ou en choisir à partir de la liste en cliquant sur le bouton ci-dessus
    </div>

    <ion-item>
        <ion-label floating><span style="color: red">* </span>Job</ion-label>
        <ion-input [(ngModel)]="jobData.job" (keyup)="watchJob($event)"></ion-input>
        <button small item-right (click)="setJobsPicker()">
            <ion-icon name="list"></ion-icon>
        </button>
    </ion-item>
    <ion-item *ngIf="jobs.length>0">
        <ion-list>
            <ion-item *ngFor="let s of jobs" (click)="jobSelected(s)">
                {{s.libelle}}
            </ion-item>
        </ion-list>
    </ion-item>
    <div [hidden]="isJobFound"
         style="color:red">
        <ion-icon name="md-arrow-dropup"></ion-icon>
        Veuillez saisir un job valide, ou en choisir à partir de la liste en cliquant sur le bouton ci-dessus
    </div>

    <!-- Level field-->
    <ion-list radio-group [(ngModel)]="jobData.level" style="margin-bottom: 5px;">
        <ion-list-header>
            <span style="color: red">* </span>Niveau d'expérience
        </ion-list-header>
        <ion-item>
            <ion-label>Débutant</ion-label>
            <ion-radio value="junior"></ion-radio>
        </ion-item>
        <ion-item>
            <ion-label>Expérimenté</ion-label>
            <ion-radio value="senior"></ion-radio>
        </ion-item>
    </ion-list>
    <!-- Remuneration field-->

    <ion-row>

        <ion-col>
            <ion-item style="padding-left: 0;">
                <ion-label floating><span style="color: red">* </span>Taux horaire brut en €</ion-label>
                <ion-input
                        type="number"
                        min="0"
                        [(ngModel)]="jobData.remuneration"
                        (keyup)="checkHourRate()"
                ></ion-input>
            </ion-item>
        </ion-col>

        <ion-col width-33 style="display: flex">
            <ion-item text-wrap>
                <ion-icon name="euro"></ion-icon>
                <ion-select [(ngModel)]="jobData.currency"
                            style="padding: 0;overflow: visible; max-width: 100%;"
                            [alertOptions]="alertOptions"
                            okText="Ok" cancelText="Annuler">
                    <ion-option value="euro" checked="true">Euro</ion-option>
                    <!--ion-option value="dollar" disabled="true">Dollar</ion-option-->
                </ion-select>
            </ion-item>
        </ion-col>

    </ion-row>

    <ion-row *ngIf="invalidHourRate && jobData.remuneration"
         style="color:red">
        <ion-icon name="md-arrow-dropup"></ion-icon>
        Le taux horaire devrait être supérieur ou égal à {{ invalidHourRateMessage }}
    </ion-row>
    <ion-row>
        <ion-col>
            <span style=""><span style="color: red">* </span>{{isEmployer?'Adresse de la mission':'Adresse de départ vers le lieu de travail'}}</span>
        </ion-col>
    </ion-row>
    <ion-row>
        <ion-col>
            <google-places [(bindModelData)]="searchData" (onPlaceChanged)='showResults($event)'></google-places>
        </ion-col>
    </ion-row>

        <ion-row *ngFor="let conventionFilter of conventionFilters">

            <ion-item *ngIf="conventionFilter.list.length > 0">
                <ion-label floating>{{ conventionFilter.labelle }}</ion-label>
                <ion-input
                        [(ngModel)]="conventionFilter.selected"
                        (keyup)="watchConvFilter(conventionFilter, $event)"
                ></ion-input>
                <button
                        small class="text-size"
                        item-right (click)="setConvNivPicker(conventionFilter)"
                >
                    <ion-icon name="list"></ion-icon>
                </button>
            </ion-item>

            <ion-item *ngIf="conventionFilter.filteredList.length > 0">
                <ion-list>
                    <ion-item
                            *ngFor="let elementFiltered of conventionFilter.filteredList"
                            [value]="elementFiltered.id"
                            (click)="updateHourRateThreshold(conventionFilter, elementFiltered)"
                    >
                        {{elementFiltered.libelle}}
                    </ion-item>
                </ion-list>
            </ion-item>

            <div [hidden]="conventionFilter.isFound"
                 style="color:red">
                <ion-icon name="md-arrow-dropup"></ion-icon>
                Veuillez saisir un niveau valide, ou en choisir à partir de la liste en cliquant sur le bouton ci-dessus
            </div>
        </ion-row>


        <ion-card *ngIf="convParametersVisible()">
            <ion-list-header><strong>Avantages salariaux</strong></ion-list-header>

                <ion-item *ngFor="let item of categoriesHeure" text-wrap>
                    <ion-label stacked>{{item.libelle}}</ion-label>
                    <ion-input [(ngModel)]="item.empValue" (change)="watchConditionEmp($event, item)"></ion-input>
                </ion-item>
                <ion-item *ngFor="let item of majorationsHeure" text-wrap>
                    <ion-label stacked>{{item.libelle}}</ion-label>
                    <ion-input [(ngModel)]="item.empValue" (change)="watchConditionEmp($event, item)"></ion-input>
                </ion-item>
                <ion-item *ngFor="let item of indemnites" text-wrap>
                    <ion-label stacked>{{item.libelle}}</ion-label>
                    <ion-input [(ngModel)]="item.empValue" (change)="watchConditionEmp($event, item)"></ion-input>
                </ion-item>
        </ion-card>

<ion-card>

        <ion-list-header text-wrap><strong>{{ isEmployer ? 'Prérequis obligatoires':'Documents nécessaires' }}</strong></ion-list-header>
        <ion-list text-wrap no-lines>
            <ion-item [hidden]="!isEmployer">
                <ion-label floating>Prérequis obligatoires</ion-label>
                <ion-input type="text" [(ngModel)]="prerequisOb" (keyup)="watchPrerequisOb($event)"></ion-input>
                <button small item-right (click)="addPrerequis()" [disabled]="!prerequisOb || prerequisOb.length==0">
                    <ion-icon name="add-circle"></ion-icon>
                </button>
            </ion-item>
            <ion-item [hidden]="isEmployer">
                <ion-label floating>Documents nécessaires</ion-label>
                <ion-input type="text" [(ngModel)]="prerequisOb" (keyup)="watchDocsNecessary($event)"></ion-input>
                <button small item-right (click)="addPrerequis()" [disabled]="!prerequisOb || prerequisOb.length==0 || !showPrerequisBtn">
                    <ion-icon name="add-circle"></ion-icon>
                </button>
            </ion-item>
        </ion-list>
        <ion-grid>

            <ion-row [hidden]="prerequisObList.length == 0">
                <ion-col width-100>
                    <ion-list>
                        <ion-item *ngFor="let p of prerequisObList" (click)="preqOSelected(p)">

                            {{p.libelle}}

                        </ion-item>
                    </ion-list>
                </ion-col>

            </ion-row>
        </ion-grid>
        <ion-list>
            <ion-item style="font-size:small" *ngFor="let p of prerequisObligatoires">
                <button (click)="removePrerequis(p)" clear small>
                    <ion-icon name="remove-circle"></ion-icon>
                </button>
                &nbsp;<span >{{p}}</span>
            </ion-item>
        </ion-list>
</ion-card>


    <ion-row>
        <ion-col text-center>
            <button [style.backgroundColor]="themeColor"
                    [disabled]="!jobData.job || !jobData.sector || !jobData.remuneration || !isSectorFound || !isJobFound || jobs.length > 0 || sectors.length > 0 || !searchData || searchData.length ==0"
                    (click)="validateJob()">
                Valider
                <ion-icon name="checkmark-circle"></ion-icon>
            </button>
        </ion-col>
    </ion-row>

    <!--/form-->


</ion-content>

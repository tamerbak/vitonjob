<ion-header>
<ion-navbar [attr.primary]="isEmployer ? '' : null" [attr.secondary]="isEmployer ? null : ''" >
  <ion-title>{{missionDetailsTitle}}</ion-title>
</ion-navbar>
</ion-header>

<ion-content padding>
	<ion-row [hidden]="!isEmployer || !missionHours || missionHours.length == 0">
        <ion-col> 
			<h6 [style.color]="themeColor"> {{optionMission}} </h6>
		</ion-col>
        <ion-col width-20>
			<button clear item-right [style.color]="themeColor" (click)="changeOption()" [hidden]="upperCase(contract.vu) == 'OUI'">
				<ion-icon name="create"></ion-icon>
			</button>	
		</ion-col>
    </ion-row>
	<ion-row [hidden]="(missionHours && missionHours.length != 0)">
        <ion-col width-10></ion-col>
        <ion-col text-center> <h6 [style.color]="themeColor"> Aucun jour de mission n'est encore défini pour ce contrat </h6></ion-col>
        <ion-col width-10></ion-col>
    </ion-row>
    <ion-card [hidden]="isEmployer ||upperCase(contract.signature_jobyer) == 'OUI' || (!missionHours || missionHours.length == 0)">
		<ion-row>
			<ion-col text-center>
			<ion-item>
			<button block (click)="launchContractPage()" [style.backgroundColor]="themeColor">
				<ion-icon name="create"></ion-icon>
				Signer votre contrat</button>
			</ion-item>
			</ion-col>
		</ion-row>
		<ion-row>
			<ion-item>
				<ion-label>Signé</ion-label>
				<ion-toggle (ionChange)="watchSignedToggle($event)"></ion-toggle>
			</ion-item>
		</ion-row>	
    </ion-card>
    <ion-card *ngFor="let day of missionHours, let i=index">
		<ion-card-header (click)="onCardClick(i)" class="cardHeader">
            Jour {{i + 1}}: {{day.jour_debut | dateConverter:'long'}}
			<ion-icon name="add-circle" [hidden]="!isNewMission || !isEmployer || upperCase(contract.signature_jobyer) == 'NON'" class="iconRight"></ion-icon>
        </ion-card-header>
        <ion-card-content style="padding: 0;">
			<ion-list>
			  <ion-item>
				<ion-label fixed>H. de début</ion-label>
				<ion-input value="{{day.heure_debut | timeConverter:'minute'}}" disabled="true"></ion-input>
				<ion-input value="{{day.heure_debut_pointe}}" [disabled]="(day.heure_debut_pointe != '' && contract.option_mission == '3.0') || contract.option_mission == '2.0' || upperCase(contract.releve_employeur) == 'OUI' || !isEmployer" [hidden]="contract.option_mission == '1.0'|| isNewMission" (click)="onHourClick(i, j, true, false)" [style.color]="upperCase(day.is_heure_debut_corrigee) == 'OUI' ? 'red' : (upperCase(day.is_heure_debut_corrigee) == 'NON' ? 'green' : '')"></ion-input>
			  </ion-item>
			  <ion-list *ngFor="let pause of missionPauses[i], let j=index" class="marginTopList">
			  <ion-item (click)="onPauseClick(i, j)">
			  <ion-row>
			  <ion-col width-90>
				<h2>Pause {{j + 1}}</h2>
				</ion-col>
				<ion-col width-10>
				<ion-icon name="trash" [hidden]="!isNewMission || !isEmployer" class="iconRight"></ion-icon>
				</ion-col>
				</ion-row>
			  </ion-item>  
			  <ion-item>
				<ion-label fixed>Début de pause</ion-label>
				<ion-datetime displayFormat="HH:mm" pickerFormat="HH mm" [(ngModel)]="pause.pause_debut" (ionChange)="checkHour(i, j, true, false, false)" [disabled]="!isNewMission || !isEmployer" minuteValues="0,15,30,45" cancelText="Annuler" doneText="Ok"></ion-datetime>
				<ion-input value="{{pause.pause_debut_pointe}}" [disabled]="(pause.pause_debut_pointe != '' && contract.option_mission == '3.0') || contract.option_mission == '2.0' || upperCase(contract.releve_employeur) == 'OUI' || !isEmployer"
				[hidden]="contract.option_mission == '1.0'|| isNewMission" (click)="onHourClick(i, j, false, true)" [style.color]="upperCase(pause.is_pause_debut_corrigee) == 'OUI' ? 'red' : (upperCase(pause.is_pause_debut_corrigee) == 'NON' ? 'green' : '')"></ion-input>
			  </ion-item>
			  <ion-item>
				<ion-label fixed>Fin de pause</ion-label>
				<ion-datetime displayFormat="HH:mm" pickerFormat="HH mm" [(ngModel)]="pause.pause_fin" (ionChange)="checkHour(i, j, false, false, false)" [disabled]="!isNewMission || !isEmployer" minuteValues="0,15,30,45" cancelText="Annuler" doneText="Ok"></ion-datetime>
				<ion-input value="{{pause.pause_fin_pointe}}" [disabled]="(pause.pause_fin_pointe != '' && contract.option_mission == '3.0') || contract.option_mission == '2.0' || upperCase(contract.releve_employeur) == 'OUI' || !isEmployer"
				[hidden]="contract.option_mission == '1.0'|| isNewMission" (click)="onHourClick(i, j, false, false)" [style.color]="upperCase(pause.is_pause_fin_corrigee) == 'OUI' ? 'red' : (upperCase(pause.is_pause_fin_corrigee) == 'NON' ? 'green' : '')"></ion-input>
			  </ion-item>
			  </ion-list>
			  <ion-item>
				<ion-label fixed>H. de fin</ion-label>
				<ion-input value="{{day.heure_fin | timeConverter:'minute'}}" disabled="true"></ion-input>
				<ion-input value="{{day.heure_fin_pointe}}" [disabled]="(day.heure_fin_pointe != '' && contract.option_mission == '3.0') || contract.option_mission == '2.0' || upperCase(contract.releve_employeur) == 'OUI' || !isEmployer" [hidden]="contract.option_mission == '1.0'|| isNewMission" (click)="onHourClick(i, j, false, false)" [style.color]="upperCase(day.is_heure_fin_corrigee) == 'OUI' ? 'red' : (upperCase(day.is_heure_fin_corrigee) == 'NON' ? 'green' : '')"></ion-input>
			  </ion-item>
			</ion-list>
		</ion-card-content>
	</ion-card>	
	<ion-row>
		<ion-col text-center>
			<button block (click)="validatePauses()" [style.backgroundColor]="themeColor" [hidden]="!isNewMission || (missionHours && missionHours.length == 0) || !isEmployer || upperCase(contract.signature_jobyer) == 'NON'">
				<ion-icon name="send"></ion-icon>
				Valider et notifier le Jobyer
			</button>
		</ion-col>
	</ion-row>
	<ion-row>
		<ion-col text-center>
			<button block (click)="signSchedule()" [style.backgroundColor]="themeColor" [hidden]="isNewMission || !isEmployer || upperCase(contract.approuve) == 'OUI' || contract.option_mission != '1.0'">
				<ion-icon name="ribbon"></ion-icon>
				Signer les horaires
			</button>
		</ion-col>
	</ion-row>
	<ion-row>
		<ion-col text-center>
			<button block (click)="validateWork()" [style.backgroundColor]="themeColor" [hidden]="!isEmployer || !invoiceReady || isNewMission" >
				<ion-icon name="ribbon"></ion-icon>
				Fin de mission
			</button>
		</ion-col>
	</ion-row>
	
	<ion-row>
		<ion-col text-center>
			<button block (click)="generateTimesheet()" [style.backgroundColor]="themeColor" [disabled]="disableTimesheetButton()" [hidden]="(missionHours && missionHours.length == 0) || !isEmployer || contract.option_mission == '1.0' || isNewMission || upperCase(contract.releve_employeur) == 'OUI'" class="button-picture">
				<ion-icon name="paper"></ion-icon>
				Générer le relevé d'heure et envoyer
			</button>
		</ion-col>
	</ion-row>
	
	<ion-row>
		<ion-col text-center>
			<button block (click)="displaySignAlert()" [style.backgroundColor]="themeColor" [hidden]="isNewMission || contract.option_mission == '1.0' || upperCase(contract.releve_employeur) == 'NON' || upperCase(contract.approuve) == 'OUI'">
				<ion-icon name="ribbon"></ion-icon>
				Signer les horaires
			</button>
		</ion-col>
	</ion-row>
	<ion-row>
		<ion-col text-center>
			<h6 [style.color]="themeColor" [hidden]="isEmployer || isNewMission || contract.option_mission != '3.0' || upperCase(contract.releve_jobyer) != 'OUI'"> En attente de signature par l'employeur </h6>
		</ion-col>
	</ion-row>
	
	
	<ion-row>
		<ion-col text-center>
			<button block (click)="resetForm()" [style.backgroundColor]="themeColor" [hidden]="!isNewMission || (missionHours && missionHours.length == 0) || !isEmployer || upperCase(contract.signature_jobyer) == 'NON'">
				<ion-icon name="refresh"></ion-icon>
				Rénitialiser
			</button>
		</ion-col>
	</ion-row>
	<ion-row>
		<ion-col text-center>
			<button [style.backgroundColor]="themeColor" block (click)="setStarPicker()">
                {{starsText==''?'Attribuer une note':starsText}}
			</button>
        </ion-col>
	</ion-row>
	<ion-row>
		<ion-col text-center>
			<button block (click)="goBack()" [style.backgroundColor]="themeColor">
				<ion-icon name="undo"></ion-icon>
				Quitter
			</button>
		</ion-col>
	</ion-row>
</ion-content>
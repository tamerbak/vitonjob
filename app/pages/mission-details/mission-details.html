<!--ion-header>
<ion-navbar [attr.primary]="isEmployer ? '' : null" [attr.secondary]="isEmployer ? null : ''" >
  <ion-title>{{missionDetailsTitle}}</ion-title>
</ion-navbar>
</ion-header-->

<ion-content padding class="mission-details" [ngStyle]="backgroundImage">
    <button clear nav-pop>
        <ion-icon name="arrow-back"></ion-icon>
        Retour à la liste<!--{{missionDetailsTitle}}-->
    </button>

    <ion-card>
        <ion-card-header (click)="setStarPicker()" style="background-color: aliceblue;">
            {{contract.titre}}
            <h3>
                <!--span>{{(starsText == '')? '': 'Note: '}}</span-->
                <span style="color: gold; font-size: large">{{(starsText == '')? '': starsText}}</span>
            </h3>
            <p>
                <span>{{(starsText=='')? 'Cliquer pour attribuer une note' : ''}}</span>
            </p>

        </ion-card-header>
        <!--[hidden]="!isEmployer || !missionHours || missionHours.length == 0"-->
        <ion-item
                [hidden]="isEmployer || isNewMission || contract.option_mission != '3.0' || upperCase(contract.releve_jobyer) != 'OUI'"
                text-wrap>
            <h6 [style.color]="themeColor"> En attente de signature par l'employeur </h6>
        </ion-item>
        <ion-card-header>Relevé d'heures de travail</ion-card-header>
        <!--ion-item [hidden]="(missionHours && missionHours.length != 0)">
            Aucun jour de mission n'est encore défini pour ce contrat
        </ion-item>
        <ion-card
                [hidden]="isEmployer ||upperCase(contract.signature_jobyer) == 'OUI' || (!missionHours || missionHours.length == 0)">
            <ion-row>
                <ion-col text-center>
                    <ion-item>
                        <button block (click)="launchContractPage()" [style.backgroundColor]="themeColor">
                            <ion-icon name="create"></ion-icon>
                            Signer votre contrat
                        </button>
                    </ion-item>
                </ion-col>
            </ion-row>
            <ion-row>
                <ion-item>
                    <ion-label>Signé</ion-label>
                    <ion-toggle (ionChange)="watchSignedToggle($event)"></ion-toggle>
                </ion-item>
            </ion-row>
        </ion-card-->

        <ion-card *ngFor="let day of missionHours, let i=index">
            <ion-card-header (click)="onCardClick(i)" class="cardHeader">
                Jour {{i + 1}}: {{day.jour_debut | dateConverter:'long'}}
                <ion-icon name="add-circle"
                          [hidden]="!isNewMission || !isEmployer || upperCase(contract.signature_jobyer) == 'NON'"
                          class="iconRight"></ion-icon>
            </ion-card-header>
            <ion-card-content style="padding: 0;">
                <ion-list>
                    <ion-grid>
                        <ion-row >
                            <ion-col></ion-col>
                            <ion-col width-33 text-center style="border-right: solid white;background-color: lightgoldenrodyellow">Manaona</ion-col>
                            <ion-col width-33 text-center style="background-color: lightgoldenrodyellow">{{contract.prenom}}</ion-col>
                        </ion-row>
                        <ion-row baseline style=" background-color: lightgoldenrodyellow; border-top: solid white;">
                            <ion-col style="font-size: small;border-right: solid white">Heure début</ion-col>
                            <ion-col width-33 style="padding: 0; border-right: solid white;" text-center>
                                <button small
                                        [style.backgroundColor]="day.heure_debut_new != 'null' ? 'orange' : 'gray'"
                                        (click)="onHourClick(i, j, true, false)">
                                    {{(day.heure_debut_new != '' && day.heure_debut_new != 'null') ?
                                    (day.heure_debut_new |
                                    timeConverter:'minute') : (day.heure_debut | timeConverter:'minute')}}
                                </button>
                            </ion-col>
                            <ion-col style="padding: 0" text-center width-33>
                                <button small
                                        [style.backgroundColor]="upperCase(day.is_heure_debut_corrigee) == 'OUI' ? 'red' : (upperCase(day.is_heure_debut_corrigee) == 'NON' ? 'green' : '')"
                                        (click)="onPointedHourClick(i, j, true, false)"
                                        [disabled]="contract.option_mission == '1.0'|| isNewMission">
                                    {{(day.heure_debut_pointe)? day.heure_debut_pointe : '--:--'}}
                                </button>
                            </ion-col>
                        </ion-row>
                        <ion-list *ngFor="let pause of missionPauses[i], let j=index" class="marginTopList">

                            <ion-row style="background-color: lightskyblue;">
                                <ion-col>Pause {{j + 1}}</ion-col>
                            </ion-row>
                            <ion-row baseline style="border-top: solid white;background-color: lightskyblue;">
                                <ion-col style="font-size: small;border-right: solid white;">Début de pause</ion-col>
                                <ion-col style="padding: 0; border-right: solid white;" text-center width-33>
                                    <button small
                                            [style.backgroundColor]="!isEmpty(pause.pause_debut_new) ? 'orange' : 'gray'"
                                            (change)="checkHour(i, j, true, false, false)"
                                            (click)="onHourClick(i, j, false, true)">
                                        {{!isEmpty(pause.pause_debut_new) ? (pause.pause_debut_new |
                                        timeConverter:'minute') : pause.pause_debut}}
                                    </button>
                                </ion-col>
                                <ion-col style="padding: 0" text-center width-33>
                                    <button small
                                            [style.backgroundColor]="upperCase(pause.is_pause_debut_corrigee) == 'OUI' ? 'red' : (upperCase(pause.is_pause_debut_corrigee) == 'NON' ? 'green' : '')"
                                            (click)="onPointedHourClick(i, j, false, true)"
                                            [disabled]="(pause.pause_debut_pointe != '' && contract.option_mission == '3.0') || contract.option_mission == '2.0' || upperCase(contract.releve_employeur) == 'OUI' || !isEmployer">
                                        {{(pause.pause_debut_pointe)? pause.pause_debut_pointe : '--:--'}}
                                    </button>
                                </ion-col>
                            </ion-row>
                            <ion-row baseline style="border-top: solid white;background-color: lightskyblue;">
                                <ion-col style="font-size: small;border-right: solid white;">Fin de pause</ion-col>
                                <ion-col style="padding: 0;border-right: solid white;" text-center width-33>
                                    <button small
                                            [style.backgroundColor]="!isEmpty(pause.pause_fin_new) ? 'orange' : 'gray'"
                                            (change)="checkHour(i, j, false, false, false)"
                                            (click)="onHourClick(i, j, false, false)">
                                        {{!isEmpty(pause.pause_debut_new) ? (pause.pause_debut_new |
                                        timeConverter:'minute') : pause.pause_debut}}
                                    </button>
                                </ion-col>
                                <ion-col style="padding: 0" text-center width-33>
                                    <button small
                                            [style.backgroundColor]="upperCase(pause.is_pause_fin_corrigee) == 'OUI' ? 'red' : (upperCase(pause.is_pause_fin_corrigee) == 'NON' ? 'green' : '')"
                                            (click)="onPointedHourClick(i, j, false, false)"
                                            [disabled]="(pause.pause_fin_pointe != '' && contract.option_mission == '3.0') || contract.option_mission == '2.0' || upperCase(contract.releve_employeur) == 'OUI' || !isEmployer">
                                        {{(pause.pause_fin_pointe)? pause.pause_fin_pointe : '--:--'}}
                                    </button>
                                </ion-col>
                            </ion-row>
                        </ion-list>

                        <ion-row baseline style="background-color: lightgoldenrodyellow;border-top: solid white;">
                            <ion-col style="font-size: small;border-right: solid white;">Heure fin</ion-col>
                            <ion-col style="padding: 0; border-right: solid white;" text-center width-33>
                                <button small [style.backgroundColor]="day.heure_fin_new != 'null' ? 'orange' : 'gray'"
                                        (click)="onHourClick(i, j, false, false)" disabled="true">
                                    {{(day.heure_fin_new != '' && day.heure_fin_new != 'null') ? (day.heure_fin_new |
                                    timeConverter:'minute') : (day.heure_fin | timeConverter:'minute')}}
                                </button>
                            </ion-col>
                            <ion-col style="padding: 0" text-center width-33>
                                <button small
                                        [style.backgroundColor]="upperCase(day.is_heure_fin_corrigee) == 'OUI' ? 'red' : (upperCase(day.is_heure_fin_corrigee) == 'NON' ? 'green' : '')"
                                        (click)="onPointedHourClick(i, j, false, false)"
                                        [disabled]="(day.heure_fin_pointe != '' && contract.option_mission == '3.0') || contract.option_mission == '2.0' || upperCase(contract.releve_employeur) == 'OUI' || !isEmployer">
                                    {{(day.heure_fin_pointe)? day.heure_fin_pointe : '--:--'}}
                                </button>
                            </ion-col>
                        </ion-row>
                    </ion-grid>
                </ion-list>
            </ion-card-content>
        </ion-card>
        <!--[hidden]=""-->
        <ion-item>
            <button item-right clear (click)="validatePauses()"
                    [hidden]="!isNewMission || (missionHours && missionHours.length == 0) || !isEmployer || upperCase(contract.signature_jobyer) == 'NON'">
                <ion-icon name="send"></ion-icon>
            </button>
            <button item-right clear (click)="displaySignAlert()"
                    [hidden]="isNewMission || !isEmployer || upperCase(contract.approuve) == 'OUI' || contract.option_mission != '1.0'">
                <ion-icon name="md-create"></ion-icon>
            </button>
            <button item-right clear (click)="validateWork()"
                    [hidden]="!isEmployer || isNewMission || upperCase(contract.approuve) != 'OUI' || (upperCase(contract.releve_jobyer) != 'OUI' && contract.option_mission == '3.0')">
                <ion-icon name="ribbon"></ion-icon>
            </button>
            <button item-right clear (click)="generateTimesheet()"
                    [hidden]="(missionHours && missionHours.length == 0) || !isEmployer || contract.option_mission == '1.0' || isNewMission || upperCase(contract.releve_employeur) == 'OUI'"
                    [disabled]="disableTimesheetButton()">
                <ion-icon name="paper"></ion-icon>
            </button>
            <button item-right clear (click)="resetForm()"
                    [hidden]="!isNewMission || (missionHours && missionHours.length == 0) || !isEmployer || upperCase(contract.signature_jobyer) == 'NON'">
                <ion-icon name="refresh"></ion-icon>
            </button>
        </ion-item>

        <ion-item class="labelInItem" text-wrap>
            <h3><ion-icon name="ios-information-circle-outline"></ion-icon> Informations :</h3>
            <p>
                <ion-icon name="ios-radio-button-on" style="color: green"></ion-icon> Horaire validé par l'employeur
            </p>
            <p>
                <ion-icon name="ios-radio-button-on" style="color: red"></ion-icon> Horaire invalidé par l'employeur
            </p>
            <p>
                <ion-icon name="ios-radio-button-on" style="color: orange"></ion-icon> Horaire prévu modifié et validé par l'employeur
            </p>
            <p>
                <ion-icon name="ios-radio-button-on" style="color: gray"></ion-icon> Horaire prévu et validé par l'employeur
            </p>
            <p [hidden]="!isNewMission || (missionHours && missionHours.length == 0) || !isEmployer || upperCase(contract.signature_jobyer) == 'NON'">
                <ion-icon name="send"></ion-icon>
                Valider et notifier le Jobyer
            </p>
            <p [hidden]="isNewMission || !isEmployer || upperCase(contract.approuve) == 'OUI' || contract.option_mission != '1.0'">
                <ion-icon name="md-create"></ion-icon>
                Signer les horaires
            </p>
            <p [hidden]="!isEmployer || isNewMission || upperCase(contract.approuve) != 'OUI' || (upperCase(contract.releve_jobyer) != 'OUI' && contract.option_mission == '3.0')">
                <ion-icon name="ribbon"></ion-icon>
                Fin de mission
            </p>
            <p [hidden]="(missionHours && missionHours.length == 0) || !isEmployer || contract.option_mission == '1.0' || isNewMission || upperCase(contract.releve_employeur) == 'OUI'">
                <ion-icon name="paper"></ion-icon>
                Générer et envoyer le relevé d'heure
            </p>
            <p [hidden]="!isNewMission || (missionHours && missionHours.length == 0) || !isEmployer || upperCase(contract.signature_jobyer) == 'NON'">
                <ion-icon name="refresh"></ion-icon>
                Rénitialiser
            </p>

        </ion-item>
    </ion-card>


    <!--ion-row [hidden]="!isEmployer || !missionHours || missionHours.length == 0">
        <ion-col> 
            <h6 [style.color]="themeColor"> {{optionMission}} </h6>
        </ion-col>
        <ion-col width-20>
            <button clear item-right [style.color]="themeColor" (click)="changeOption()" [hidden]="upperCase(contract.vu) == 'OUI'">
                <ion-icon name="create"></ion-icon>
            </button>
        </ion-col>
    </ion-row>
    <ion-row [hidden]="(missionHours && missionHours.length != 0)">
        <ion-col width-10></ion-col>
        <ion-col text-center> <h6 [style.color]="themeColor"> Aucun jour de mission n'est encore défini pour ce contrat </h6></ion-col>
        <ion-col width-10></ion-col>
    </ion-row>
    <ion-card [hidden]="isEmployer ||upperCase(contract.signature_jobyer) == 'OUI' || (!missionHours || missionHours.length == 0)">
        <ion-row>
            <ion-col text-center>
            <ion-item>
            <button block (click)="launchContractPage()" [style.backgroundColor]="themeColor">
                <ion-icon name="create"></ion-icon>
                Signer votre contrat</button>
            </ion-item>
            </ion-col>
        </ion-row>
        <ion-row>
            <ion-item>
                <ion-label>Signé</ion-label>
                <ion-toggle (ionChange)="watchSignedToggle($event)"></ion-toggle>
            </ion-item>
        </ion-row>
    </ion-card>
    <ion-card *ngFor="let day of missionHours, let i=index">
        <ion-card-header (click)="onCardClick(i)" class="cardHeader">
            Jour {{i + 1}}: {{day.jour_debut | dateConverter:'long'}}
            <ion-icon name="add-circle" [hidden]="!isNewMission || !isEmployer || upperCase(contract.signature_jobyer) == 'NON'" class="iconRight"></ion-icon>
        </ion-card-header>
        <ion-card-content style="padding: 0;">
            <ion-list>
              <ion-item>
                <ion-label fixed>H. de début</ion-label>
                <ion-input value="{{(day.heure_debut_new != '' && day.heure_debut_new != 'null') ? (day.heure_debut_new | timeConverter:'minute') : (day.heure_debut | timeConverter:'minute')}}" disabled="true" (click)="onHourClick(i, j, true, false)" [style.color]="day.heure_debut_new != 'null' ? 'orange' : 'gray'"></ion-input>
                <ion-input value="{{day.heure_debut_pointe}}" [disabled]="(day.heure_debut_pointe != '' && contract.option_mission == '3.0') || contract.option_mission == '2.0' || upperCase(contract.releve_employeur) == 'OUI' || !isEmployer" [hidden]="contract.option_mission == '1.0'|| isNewMission" (click)="onPointedHourClick(i, j, true, false)" [style.color]="upperCase(day.is_heure_debut_corrigee) == 'OUI' ? 'red' : (upperCase(day.is_heure_debut_corrigee) == 'NON' ? 'green' : '')"></ion-input>
              </ion-item>
              <ion-list *ngFor="let pause of missionPauses[i], let j=index" class="marginTopList">
              <ion-item (click)="onPauseClick(i, j)">
              <ion-row>
              <ion-col width-90>
                <h2>Pause {{j + 1}}</h2>
                </ion-col>
                <ion-col width-10>
                <ion-icon name="trash" [hidden]="!isNewMission || !isEmployer" class="iconRight"></ion-icon>
                </ion-col>
                </ion-row>
              </ion-item>
              <ion-item>
                <ion-label fixed>Début de pause</ion-label>
                <ion-input value="{{!isEmpty(pause.pause_debut_new) ? (pause.pause_debut_new | timeConverter:'minute') : pause.pause_debut}}" (change)="checkHour(i, j, true, false, false)" disabled="true" (click)="onHourClick(i, j, false, true)" [style.color]="!isEmpty(pause.pause_debut_new) ? 'orange' : 'gray'" ></ion-input>
                <ion-input value="{{pause.pause_debut_pointe}}" [disabled]="(pause.pause_debut_pointe != '' && contract.option_mission == '3.0') || contract.option_mission == '2.0' || upperCase(contract.releve_employeur) == 'OUI' || !isEmployer"
                [hidden]="contract.option_mission == '1.0'|| isNewMission" (click)="onPointedHourClick(i, j, false, true)" [style.color]="upperCase(pause.is_pause_debut_corrigee) == 'OUI' ? 'red' : (upperCase(pause.is_pause_debut_corrigee) == 'NON' ? 'green' : '')"></ion-input>
              </ion-item>
              <ion-item>
                <ion-label fixed>Fin de pause</ion-label>
                <ion-input value="{{!isEmpty(pause.pause_fin_new) ? (pause.pause_fin_new | timeConverter:'minute') : (pause.pause_fin)}}" (change)="checkHour(i, j, false, false, false)" disabled="true" (click)="onHourClick(i, j, false, false)" [style.color]="!isEmpty(pause.pause_fin_new) ? 'orange' : 'gray'" ></ion-input>
                <ion-input value="{{pause.pause_fin_pointe}}" [disabled]="(pause.pause_fin_pointe != '' && contract.option_mission == '3.0') || contract.option_mission == '2.0' || upperCase(contract.releve_employeur) == 'OUI' || !isEmployer"
                [hidden]="contract.option_mission == '1.0'|| isNewMission" (click)="onPointedHourClick(i, j, false, false)" [style.color]="upperCase(pause.is_pause_fin_corrigee) == 'OUI' ? 'red' : (upperCase(pause.is_pause_fin_corrigee) == 'NON' ? 'green' : '')"></ion-input>
              </ion-item>
              </ion-list>
              <ion-item>
                <ion-label fixed>H. de fin</ion-label>
                <ion-input value="{{(day.heure_fin_new != '' && day.heure_fin_new != 'null') ? (day.heure_fin_new | timeConverter:'minute') : (day.heure_fin | timeConverter:'minute')}}" disabled="true" (click)="onHourClick(i, j, false, false)" [style.color]="day.heure_fin_new != 'null' ? 'orange' : 'gray'"></ion-input>
                <ion-input value="{{day.heure_fin_pointe}}" [disabled]="(day.heure_fin_pointe != '' && contract.option_mission == '3.0') || contract.option_mission == '2.0' || upperCase(contract.releve_employeur) == 'OUI' || !isEmployer" [hidden]="contract.option_mission == '1.0'|| isNewMission" (click)="onPointedHourClick(i, j, false, false)" [style.color]="upperCase(day.is_heure_fin_corrigee) == 'OUI' ? 'red' : (upperCase(day.is_heure_fin_corrigee) == 'NON' ? 'green' : '')"></ion-input>
              </ion-item>
            </ion-list>
        </ion-card-content>
    </ion-card>

    <ion-row>
        <ion-col text-center>
            <button block (click)="signSchedule()" [style.backgroundColor]="themeColor" [hidden]="isNewMission || !isEmployer || upperCase(contract.approuve) == 'OUI' || contract.option_mission != '1.0'">
                <ion-icon name="ribbon"></ion-icon>
                Signer les horaires
            </button>
        </ion-col>
    </ion-row>
    <ion-row>
        <ion-col text-center>
            <button block (click)="validateWork()" [style.backgroundColor]="themeColor" [hidden]="!isEmployer || isNewMission || upperCase(contract.approuve) != 'OUI' || (upperCase(contract.releve_jobyer) != 'OUI' && contract.option_mission == '3.0')" >
                <ion-icon name="ribbon"></ion-icon>
                Fin de mission
            </button>
        </ion-col>
    </ion-row>

    <ion-row>
        <ion-col text-center>
            <button block (click)="generateTimesheet()" [style.backgroundColor]="themeColor" [disabled]="disableTimesheetButton()" [hidden]="(missionHours && missionHours.length == 0) || !isEmployer || contract.option_mission == '1.0' || isNewMission || upperCase(contract.releve_employeur) == 'OUI'" class="button-picture">
                <ion-icon name="paper"></ion-icon>
                Générer le relevé d'heure et envoyer
            </button>
        </ion-col>
    </ion-row-->

</ion-content>